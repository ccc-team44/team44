version: '3.6'

services:
  couch_db_master:
    image: "ibmcom/couchdb3:3.0.0"
    restart: always
    ports:
      - 5984:5984
      - 4369:4369
      - "9100-9200:9100-9200"
    links:
    {%for i in range(1,5) %}
      - couch_node_{{ i }}
    {% endfor %}

    environment:
      COUCHDB_USER: {{ database_user }}
      COUCHDB_PASSWORD: {{ database_password }}
      NODENAME: COMP90024[0]
    volumes:
      - {{ couch_db_data_dir }}:/opt/couchdb/data

  {% for i in range(1,5) %}
  couch_db_node_{{ i }}:
    image: "couchdb:3.0.0"
    restart: always
    ports:
      - {{ i + 5984 }}:5984
    environment:
      COUCHDB_USER: {{ database_user }}
      COUCHDB_PASSWORD: {{ database_password }}
      NODENAME: COMP90024[{{ i }}]
    volumes:
      - {{ couch_db_data_dir }}:/opt/couchdb/data
    container_name: couch_db_node_{{ i }}
  {% endfor %}

